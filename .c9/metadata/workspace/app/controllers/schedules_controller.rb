{"filter":false,"title":"schedules_controller.rb","tooltip":"/app/controllers/schedules_controller.rb","undoManager":{"mark":100,"position":100,"stack":[[{"group":"doc","deltas":[{"start":{"row":23,"column":18},"end":{"row":23,"column":19},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":17},"end":{"row":23,"column":18},"action":"remove","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":16},"end":{"row":23,"column":17},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":15},"end":{"row":23,"column":16},"action":"remove","lines":["l"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":14},"end":{"row":23,"column":15},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":13},"end":{"row":23,"column":14},"action":"remove","lines":["d"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":12},"end":{"row":23,"column":13},"action":"remove","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":35},"end":{"row":23,"column":36},"action":"insert","lines":[","]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":36},"end":{"row":23,"column":37},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":37},"end":{"row":23,"column":38},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":38},"end":{"row":23,"column":39},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":39},"end":{"row":23,"column":40},"action":"insert","lines":["m"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":40},"end":{"row":23,"column":41},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":41},"end":{"row":23,"column":42},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":42},"end":{"row":23,"column":43},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":43},"end":{"row":23,"column":44},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":44},"end":{"row":23,"column":45},"action":"insert","lines":["r"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":45},"end":{"row":23,"column":46},"action":"insert","lines":[":"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":46},"end":{"row":23,"column":47},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":47},"end":{"row":23,"column":48},"action":"insert","lines":["@"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":48},"end":{"row":23,"column":49},"action":"insert","lines":["a"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":49},"end":{"row":23,"column":50},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":50},"end":{"row":23,"column":51},"action":"insert","lines":["t"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":51},"end":{"row":23,"column":52},"action":"insert","lines":["i"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":52},"end":{"row":23,"column":53},"action":"insert","lines":["v"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":53},"end":{"row":23,"column":54},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":54},"end":{"row":23,"column":55},"action":"insert","lines":["_"]}]}],[{"group":"doc","deltas":[{"start":{"row":23,"column":48},"end":{"row":23,"column":55},"action":"remove","lines":["active_"]},{"start":{"row":23,"column":48},"end":{"row":23,"column":63},"action":"insert","lines":["active_semester"]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":13},"end":{"row":28,"column":30},"action":"remove","lines":["sch.errors.blank?"]},{"start":{"row":28,"column":13},"end":{"row":28,"column":93},"action":"insert","lines":["Schedule.create(user_id: @user.id, offering_id: oid, semester: @active_semester)"]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":0},"end":{"row":28,"column":0},"action":"remove","lines":["      sch = Schedule.create(user_id: @user.id, offering_id: oid, semester: @active_semester)",""]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":19},"end":{"row":28,"column":23},"action":"remove","lines":["@sch"]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":18},"end":{"row":28,"column":19},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":17},"end":{"row":28,"column":18},"action":"remove","lines":["<"]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":16},"end":{"row":28,"column":17},"action":"remove","lines":["<"]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":15},"end":{"row":28,"column":16},"action":"remove","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":14},"end":{"row":28,"column":15},"action":"remove","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":13},"end":{"row":27,"column":14},"action":"insert","lines":["@"]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":14},"end":{"row":27,"column":15},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":15},"end":{"row":27,"column":16},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":16},"end":{"row":27,"column":17},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":17},"end":{"row":27,"column":18},"action":"insert","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":17},"end":{"row":27,"column":18},"action":"remove","lines":["e"]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":17},"end":{"row":27,"column":18},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":18},"end":{"row":27,"column":19},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":19},"end":{"row":27,"column":20},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":100},"end":{"row":27,"column":101},"action":"insert","lines":[")"]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":13},"end":{"row":27,"column":14},"action":"insert","lines":["("]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":14},"end":{"row":28,"column":15},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":15},"end":{"row":28,"column":16},"action":"insert","lines":["<"]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":16},"end":{"row":28,"column":17},"action":"insert","lines":["<"]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":17},"end":{"row":28,"column":18},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":18},"end":{"row":28,"column":19},"action":"insert","lines":["@"]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":19},"end":{"row":28,"column":20},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":20},"end":{"row":28,"column":21},"action":"insert","lines":["c"]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":21},"end":{"row":28,"column":22},"action":"insert","lines":["h"]}]}],[{"group":"doc","deltas":[{"start":{"row":27,"column":14},"end":{"row":27,"column":15},"action":"remove","lines":["@"]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":18},"end":{"row":28,"column":19},"action":"remove","lines":["@"]}]}],[{"group":"doc","deltas":[{"start":{"row":33,"column":4},"end":{"row":33,"column":6},"action":"insert","lines":["# "]},{"start":{"row":34,"column":4},"end":{"row":34,"column":6},"action":"insert","lines":["# "]},{"start":{"row":35,"column":4},"end":{"row":35,"column":6},"action":"insert","lines":["# "]},{"start":{"row":36,"column":4},"end":{"row":36,"column":6},"action":"insert","lines":["# "]}]}],[{"group":"doc","deltas":[{"start":{"row":40,"column":0},"end":{"row":41,"column":0},"action":"remove","lines":["      format.html { redirect_to user_schedules_path(@user), notice: 'You succussfully signed up for courses' }",""]}]}],[{"group":"doc","deltas":[{"start":{"row":28,"column":14},"end":{"row":28,"column":15},"action":"insert","lines":["s"]}]}],[{"group":"doc","deltas":[{"start":{"row":33,"column":4},"end":{"row":33,"column":6},"action":"remove","lines":["# "]},{"start":{"row":34,"column":4},"end":{"row":34,"column":6},"action":"remove","lines":["# "]},{"start":{"row":35,"column":4},"end":{"row":35,"column":6},"action":"remove","lines":["# "]},{"start":{"row":36,"column":4},"end":{"row":36,"column":6},"action":"remove","lines":["# "]}]}],[{"group":"doc","deltas":[{"start":{"row":33,"column":0},"end":{"row":37,"column":4},"action":"remove","lines":["    @day_hash = view_context.create_day_hash(@offerings)","    @new_work_schedule = WorkSchedule.new","    @work_schedules = WorkSchedule.where(user: @user, semester: @active_semester)","    @work_time_slots = WorkDaysTime.all","    "]}]}],[{"group":"doc","deltas":[{"start":{"row":74,"column":7},"end":{"row":75,"column":0},"action":"insert","lines":["",""]},{"start":{"row":75,"column":0},"end":{"row":75,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":2},"end":{"row":75,"column":4},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":0},"end":{"row":75,"column":2},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":75,"column":0},"end":{"row":76,"column":0},"action":"insert","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":76,"column":0},"end":{"row":204,"column":7},"action":"insert","lines":["    def toposort(data)","        sorted =[]","        ","        until data.length == 0","            temp = []","            data.each do |k, v|","                if v.empty?","                    temp << k","                end","            end","            ","            sorted << temp","            ","            temp.each do |k|","                data.delete(k)","                ","                data.each do |key, val|","                    if val.include?(k)","                        val.delete(k)","                    end","                end","            end","        end","      sorted","    end","    ","    def sched_algorithm(uid) ","      @schedule = Schedule.new","      @category_courses = Hash.new","      @common_courses = Hash.new","      @category_credits = Hash.new","      @class_hash = Hash.new","      @remaining_credits = Hash.new","","      @user_courses = Transcript.where(user_id: uid).collect(&:course_id)","           ","      CurriculumCategory.where(major: User.find(uid).major_id, minor: false).each do |category|","         @category_courses[category.id] = category.curriculum_category_courses.collect(&:course_id)","         category.curriculum_category_courses.each do |course|","           @class_hash[course.course_id] = Set.new (course.course.courses.collect(&:id))","         end","         @common_courses[category.id] = ((@category_courses[category.id] & @user_courses).collect { |c_id| Course.find(c_id) }).sort! { |a,b| b.course <=> a.course }","         @category_credits[category.id] = (@common_courses[category.id].collect { |c| Course.find(c).credits }).inject(:+)","         ","         if @category_credits[category.id] != nil","           @remaining_credits[category.id] = category.required_amount_of_credits - @category_credits[category.id]","         else","            @remaining_credits[category.id] = category.required_amount_of_credits","         end","        ","         if @category_credits[category.id] and ((@category_credits[category.id] - category.required_amount_of_credits) >= 0)","            @category_credits.delete(category.id)","         end","      end","      ","      User.find(uid).minor.each do |minor_id|","        CurriculumCategory.where(major: minor_id, minor: true).each do |category|","           @category_courses[category.id] = category.curriculum_category_courses.collect(&:course_id)","           category.curriculum_category_courses.each do |course|","             @class_hash[course.course_id] = Set.new (course.course.courses.collect(&:id))","           end","           @common_courses[category.id] = ((@category_courses[category.id] & @user_courses).collect { |c_id| Course.find(c_id) }).sort! { |a,b| b.course <=> a.course }","           @category_credits[category.id] = (@common_courses[category.id].collect { |c| Course.find(c).credits }).inject(:+)","           ","           if @category_credits[category.id] != nil","             @remaining_credits[category.id] = category.required_amount_of_credits - @category_credits[category.id]","           else","              @remaining_credits[category.id] = category.required_amount_of_credits","           end","          ","           if @category_credits[category.id] and ((@category_credits[category.id] - category.required_amount_of_credits) >= 0)","              @category_credits.delete(category.id)","           end","        end    ","      end","      ","      @categories_left = @category_credits.keys","      ","      @user_courses.each do |c|","        @class_hash.delete(c)","        ","        keys = @class_hash.keys","        keys.each do |key|","          @class_hash[key] = (@class_hash[key].to_a - [c]).to_set","        end","      end","  ","      @sorted = toposort(@class_hash)[0]","      ","      @new_category_courses = Hash.new","      @categories_left.each do |cat|","          @new_category_courses[cat] = @category_courses[cat] & @sorted","      end","        ","        NeededCourse.where(user_id: uid, semester: Semester.where(active: true).take).destroy_all","      @new_category_courses.values.flatten.each do |course_id|","          if not Offering.where(course_id: course_id, semester: Semester.where(active: true).take).exists?","              NeededCourse.create(user_id: uid, semester: Semester.where(active: true).take, course_id: course_id)","          end","      end","          ","      ","      work_schedules = WorkSchedule.where(user_id: uid, semester: Semester.where(active: true).take)","      @new_category_courses.each do |k, v|","        x = []","        y = []","","        v.each do |id|","          Offering.where(course_id: id, semester: Semester.where(active: true).take).each do |offering|","           work_schedules.each do |work|","            if offering.days_time.days.include?(work.work_days_time.days)","              start_time = Time.parse(offering.days_time.start_time + \"00-01-01\")","              end_time  = Time.parse(offering.days_time.end_time + \"00-01-01\")","","              if ((start_time - work.work_days_time.end_time) * (work.work_days_time.start_time - end_time) ) > 0","              \tx << offering","              end","            end","          end","          y << offering","          end","        end","        @new_category_courses[k] = y.uniq - x.uniq","      end","","      @schedules = @user.schedules.collect { |course| Offering.find(course.offering_id) }","      ","      return @schedules, @common_courses, @new_category_courses, @remaining_credits","    end"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":78},"end":{"row":17,"column":90},"action":"remove","lines":["view_context"]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":78},"end":{"row":17,"column":79},"action":"remove","lines":["."]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":9},"end":{"row":17,"column":0},"action":"insert","lines":["",""]},{"start":{"row":17,"column":0},"end":{"row":17,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":2},"end":{"row":17,"column":4},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":17,"column":0},"end":{"row":17,"column":2},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":16,"column":9},"end":{"row":17,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":0},"end":{"row":18,"column":2},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":2},"end":{"row":18,"column":4},"action":"insert","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":18,"column":4},"end":{"row":18,"column":81},"action":"insert","lines":["@work_schedules = WorkSchedule.where(user: @user, semester: @active_semester)"]}]}],[{"group":"doc","deltas":[{"start":{"row":178,"column":0},"end":{"row":179,"column":0},"action":"remove","lines":["      work_schedules = WorkSchedule.where(user_id: uid, semester: Semester.where(active: true).take)",""]}]}],[{"group":"doc","deltas":[{"start":{"row":179,"column":0},"end":{"row":181,"column":0},"action":"remove","lines":["        x = []","        y = []",""]}]}],[{"group":"doc","deltas":[{"start":{"row":179,"column":0},"end":{"row":180,"column":0},"action":"remove","lines":["",""]}]}],[{"group":"doc","deltas":[{"start":{"row":181,"column":0},"end":{"row":182,"column":0},"action":"remove","lines":["           work_schedules.each do |work|",""]}]}],[{"group":"doc","deltas":[{"start":{"row":178,"column":42},"end":{"row":179,"column":0},"action":"insert","lines":["",""]},{"start":{"row":179,"column":0},"end":{"row":179,"column":8},"action":"insert","lines":["        "]}]}],[{"group":"doc","deltas":[{"start":{"row":179,"column":8},"end":{"row":179,"column":9},"action":"insert","lines":["x"]}]}],[{"group":"doc","deltas":[{"start":{"row":179,"column":9},"end":{"row":179,"column":10},"action":"insert","lines":["x"]}]}],[{"group":"doc","deltas":[{"start":{"row":179,"column":10},"end":{"row":179,"column":11},"action":"insert","lines":["="]}]}],[{"group":"doc","deltas":[{"start":{"row":179,"column":11},"end":{"row":179,"column":12},"action":"insert","lines":[" "]}]}],[{"group":"doc","deltas":[{"start":{"row":179,"column":12},"end":{"row":179,"column":14},"action":"insert","lines":["[]"]}]}],[{"group":"doc","deltas":[{"start":{"row":179,"column":8},"end":{"row":179,"column":9},"action":"remove","lines":["x"]}]}],[{"group":"doc","deltas":[{"start":{"row":182,"column":12},"end":{"row":186,"column":113},"action":"remove","lines":["if offering.days_time.days.include?(work.work_days_time.days)","              start_time = Time.parse(offering.days_time.start_time + \"00-01-01\")","              end_time  = Time.parse(offering.days_time.end_time + \"00-01-01\")","","              if ((start_time - work.work_days_time.end_time) * (work.work_days_time.start_time - end_time) ) > 0"]}]}],[{"group":"doc","deltas":[{"start":{"row":184,"column":0},"end":{"row":185,"column":0},"action":"remove","lines":["              end",""]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":14},"end":{"row":183,"column":15},"action":"remove","lines":["\t"]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":12},"end":{"row":183,"column":14},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":182,"column":12},"end":{"row":183,"column":12},"action":"remove","lines":["","            "]}]}],[{"group":"doc","deltas":[{"start":{"row":183,"column":0},"end":{"row":184,"column":0},"action":"remove","lines":["            end",""]}]}],[{"group":"doc","deltas":[{"start":{"row":184,"column":0},"end":{"row":185,"column":0},"action":"remove","lines":["          y << offering",""]}]}],[{"group":"doc","deltas":[{"start":{"row":184,"column":0},"end":{"row":185,"column":0},"action":"remove","lines":["          end",""]}]}],[{"group":"doc","deltas":[{"start":{"row":185,"column":35},"end":{"row":185,"column":50},"action":"remove","lines":["y.uniq - x.uniq"]},{"start":{"row":185,"column":35},"end":{"row":185,"column":36},"action":"insert","lines":["x"]}]}],[{"group":"doc","deltas":[{"start":{"row":13,"column":39},"end":{"row":14,"column":0},"action":"insert","lines":["",""]},{"start":{"row":14,"column":0},"end":{"row":14,"column":4},"action":"insert","lines":["    "]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":2},"end":{"row":14,"column":4},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":0},"end":{"row":14,"column":2},"action":"remove","lines":["  "]}]}],[{"group":"doc","deltas":[{"start":{"row":14,"column":0},"end":{"row":16,"column":0},"action":"insert","lines":["    @majors = (Major.all.map { |major| [major.major, major.id] }) << [\"\", \"-1\"]","    @minors = (Major.all.map { |major| [major.major, major.id] if @user.major_id != major.id})",""]}]}],[{"group":"doc","deltas":[{"start":{"row":15,"column":94},"end":{"row":16,"column":0},"action":"remove","lines":["",""]}]}]]},"ace":{"folds":[],"scrolltop":60,"scrollleft":0,"selection":{"start":{"row":9,"column":0},"end":{"row":10,"column":0},"isBackwards":false},"options":{"tabSize":2,"useSoftTabs":true,"guessTabSize":false,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":3,"state":"start","mode":"ace/mode/ruby"}},"timestamp":1424458709608,"hash":"40bf2813806a3e0ddfbfb4abd3dcd55d919d96c4"}
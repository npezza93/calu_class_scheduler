<% @errors.each do |error_msg_slot| %>
    <% error_msg_slot.errors.full_messages.each do |error_message| %>
        document.getElementById("schedule_new_actual_select").options[$("#schedule_new_actual_select option[value=" + "<%= error_msg_slot.offering_id %>" + "]").index()].selected = false;
        document.getElementById("<%= error_msg_slot.offering_id %>").removeAttribute("checked", "");
        $("#schedule_errors").html("<paper-toast class=\"capsule\" text=\"<%= error_message %>!\" style=\"padding-right: 60px;color: #eeff41;\" duration=\"10000\" opened ></paper-toast>");
    <% end %>
<% end %>

var sel_opts = [], nsel_opts = [], asel_opts = [];
var credit_count = 0;
var sel_dates_array = [];
var nsel_dates_array = [];
var disable = [];

$("#schedule_new_actual_select option:selected").each(function() { 
    sel_opts.push($(this).attr('value'));
    asel_opts.push($(this).attr('value'));
});

$("#schedule_new_actual_select option:not(:selected)").each(function() { 
    nsel_opts.push($(this).attr('value'));
    asel_opts.push($(this).attr('value'));
});

$.each(sel_opts,function(index, value) {
    var t = $("#"+value).parent().parent();
    credit_count += parseInt(t.find(".new_schedule_credit_td").text());
    
    var d = [t.find(".new_schedule_days_td").text(),t.find(".new_schedule_times_td").text().split(" - ")[0],t.find(".new_schedule_times_td").text().split(" - ")[1],t.find(".new_schedule_course_td").text()];
    
    if (d[1].split(" ")[1] == "pm") {
        d[1] = new Date(2000, 1, 1, d[1].split(":")[0], d[1].split(":")[1].split(" ")[0]);
        d[1].setHours(d[1].getHours() + 12);
    } else {
        d[1] = new Date(2000, 1, 1, d[1].split(":")[0], d[1].split(":")[1].split(" ")[0]);
    }

    if (d[2].split(" ")[1] == "pm") {
        d[2] = new Date(2000, 1, 1, d[2].split(":")[0], d[2].split(":")[1].split(" ")[0]);
        d[2].setHours(d[2].getHours() + 12);
    } else {
        d[2] = new Date(2000, 1, 1, d[2].split(":")[0], d[2].split(":")[1].split(" ")[0]);
    }
    sel_dates_array.push(d);
});

$.each(nsel_opts,function(index, value) {
    var t = $("#"+value).parent().parent();
    if ((credit_count + parseInt(t.find(".new_schedule_credit_td").text()))>18) {
        disable.push(value);
    }
    
    var d = [t.find(".new_schedule_days_td").text(),t.find(".new_schedule_times_td").text().split(" - ")[0],t.find(".new_schedule_times_td").text().split(" - ")[1],t.find(".new_schedule_course_td").text()];
    
    if (d[1].split(" ")[1] == "pm") {
        d[1] = new Date(2000, 1, 1, d[1].split(":")[0], d[1].split(":")[1].split(" ")[0]);
        d[1].setHours(d[1].getHours() + 12);
    } else {
        d[1] = new Date(2000, 1, 1, d[1].split(":")[0], d[1].split(":")[1].split(" ")[0]);
    }

    if (d[2].split(" ")[1] == "pm") {
        d[2] = new Date(2000, 1, 1, d[2].split(":")[0], d[2].split(":")[1].split(" ")[0]);
        d[2].setHours(d[2].getHours() + 12);
    } else {
        d[2] = new Date(2000, 1, 1, d[2].split(":")[0], d[2].split(":")[1].split(" ")[0]);
    }
    nsel_dates_array.push(d);
});

$.each(nsel_opts,function(index1, value1) {
    $.each(sel_opts,function(index2, value2) {
        if (sel_dates_array[index2][0] == nsel_dates_array[index1][0]) {
            if ((sel_dates_array[index2][1] <= nsel_dates_array[index1][2]) && (nsel_dates_array[index1][1] <=sel_dates_array[index2][2])) {
                disable.push(value1);
            }
        }
        
        if (sel_dates_array[index2][3] == nsel_dates_array[index1][3]) {
            disable.push(value1);
        }
    });
});
disable = jQuery.unique( disable );
asel_opts = $(asel_opts).not(disable).get();

$.each(disable,function(index, value) {
    $("."+value).attr("disabled", "");
});
    
$.each(asel_opts,function(index, value) {
    $("."+value).removeAttr("disabled", "");
});

$("#sch_approval_div").html("<%= j render(:partial => 'schedule_approvals/show') %>");

<% if request.path == "/users/"+@user.id.to_s+"/schedules" %>
    $("#section1").html("<%= escape_javascript render 'index', :@offerings => @user_schedules.collect { |c| c.offering }, :@day_hash => @day_hash2%>");
    $("#media_query_schedule").on("core-media-change", function(e) {
      if (e.originalEvent.detail.matches === true) {
        $("#big_schedule_table")[0].setAttribute("hidden", "");
        $("#small_schedule_table")[0].removeAttribute("hidden", "");
        $(".small_schedule_course_title").removeAttr("hidden", "");
      } else {
        $("#big_schedule_table")[0].removeAttribute("hidden", "");
        $("#small_schedule_table")[0].setAttribute("hidden", "");
        $(".small_schedule_course_title").attr("hidden", "");
      }
    });
    $('.day_time_slot').click(function(e) {
        if ($("#drawer_core_menu").children().length <11) {
          var id_string;
          if ($('.' + e.originalEvent.toElement.className.split(' ')[1]).text() === "" && !$('.' + e.originalEvent.toElement.className.split(' ')[1]).hasClass("half_time_slot")) {
            $('.' + e.originalEvent.toElement.className.split(' ')[1]).toggleClass('selected_work_day_time_slot');
            id_string = '#work_schedule_work_days_time_id option[value=' + e.originalEvent.toElement.id.substring(1) + ']';
            if ($('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected) {
              $('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected = false;
            } else {
              $('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected = true;
            }
            $("#submit_work_schedule_button")[0].click();
          }
        }
    });
    
    $('.time_slot').click(function(e) {
        if ($("#drawer_core_menu").children().length <11) {
          var id_string, time_string;
          time_string = $.trim(e.toElement.innerHTML.replace(/:/g, ''));
          if ($('.M' + time_string).text() === "" && !$('.M' + time_string).hasClass("half_time_slot")) {
            $('.M' + time_string).toggleClass('selected_work_day_time_slot');
            id_string = '#work_schedule_work_days_time_id option[value=' + $('.M' + time_string)[0].id.substring(1) + ']';
            if ($('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected) {
              $('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected = false;
            } else {
              $('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected = true;
            }
          }
          if ($('.T' + time_string).text() === "" && !$('.T' + time_string).hasClass("half_time_slot")) {
            $('.T' + time_string).toggleClass('selected_work_day_time_slot');
            id_string = '#work_schedule_work_days_time_id option[value=' + $('.T' + time_string)[0].id.substring(1) + ']';
            if ($('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected) {
              $('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected = false;
            } else {
              $('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected = true;
            }
          }
          if ($('.W' + time_string).text() === "" && !$('.W' + time_string).hasClass("half_time_slot")) {
            $('.W' + $.trim(e.toElement.innerHTML.replace(/:/g, ''))).toggleClass('selected_work_day_time_slot');
            id_string = '#work_schedule_work_days_time_id option[value=' + $('.W' + time_string)[0].id.substring(1) + ']';
            if ($('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected) {
              $('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected = false;
            } else {
              $('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected = true;
            }
          }
          if ($('.R' + time_string).text() === "" && !$('.R' + time_string).hasClass("half_time_slot")) {
            $('.R' + $.trim(e.toElement.innerHTML.replace(/:/g, ''))).toggleClass('selected_work_day_time_slot');
            id_string = '#work_schedule_work_days_time_id option[value=' + $('.R' + time_string)[0].id.substring(1) + ']';
            if ($('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected) {
              $('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected = false;
            } else {
              $('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected = true;
            }
          }
          if ($('.F' + time_string).text() === "" && !$('.F' + time_string).hasClass("half_time_slot")) {
            $('.F' + $.trim(e.toElement.innerHTML.replace(/:/g, ''))).toggleClass('selected_work_day_time_slot');
            id_string = '#work_schedule_work_days_time_id option[value=' + $('.F' + time_string)[0].id.substring(1) + ']';
            if ($('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected) {
              $('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected = false;
            } else {
              $('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected = true;
            }
          }
          $("#submit_work_schedule_button")[0].click();
        }
    });
    
    $('.day').click(function(e) {
        if ($("#drawer_core_menu").children().length <11) {
          var id_string;
          var begin_time, end_time, id_string;
          begin_time = new Date(2000, 1, 1, 8, 0x0);
          end_time = new Date(2000, 1, 1, 21, 30);
          while (begin_time.getTime() <= end_time.getTime()) {
            if (e.toElement.innerHTML !== 'Thursday') {
              if ($('.' + e.toElement.innerHTML.charAt(0) + begin_time.toString('hmmtt')).text() === '' && !$('.' + e.toElement.innerHTML.charAt(0) + begin_time.toString('hmmtt')).hasClass("half_time_slot")) {
                $('.' + e.toElement.innerHTML.charAt(0) + begin_time.toString('hmmtt')).toggleClass('selected_work_day_time_slot');
                id_string = '#work_schedule_work_days_time_id option[value=' + $('.' + e.toElement.innerHTML.charAt(0) + begin_time.toString('hmmtt'))[0].id.substring(1) + ']';
                if ($('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected) {
                  $('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected = false;
                } else {
                  $('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected = true;
                }
              }
            } else {
              if ($('.R' + begin_time.toString('hmmtt')).text() === '' && !$('.' + e.toElement.innerHTML.charAt(0) + begin_time.toString('hmmtt')).hasClass("half_time_slot")) {
                $('.R' + begin_time.toString('hmmtt')).toggleClass('selected_work_day_time_slot');
                id_string = '#work_schedule_work_days_time_id option[value=' + $('.R' + begin_time.toString('hmmtt'))[0].id.substring(1) + ']';
                if ($('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected) {
                  $('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected = false;
                } else {
                  $('#work_schedule_work_days_time_id')[0].options[$(id_string).index()].selected = true;
                }
              }
            }
            begin_time.setMinutes(begin_time.getMinutes() + 30);
          }
          $("#submit_work_schedule_button")[0].click();
        }
    });
    
    $("#submit_approval_paper_button").click(function() {
      $("#submit_approval_button")[0].click();
    });
      
    $("#advisor_approve_schedule_button").click(function() {
      $("#advisor_approve_schedule_link")[0].click();
    });
<% end %>

<core-toolbar>
    <h2 flex><%= @user.email %>'s Schedule</h2>
    <paper-fab icon="cloud-upload" style="margin-top:56px;" id="fab_new_schedule"></paper-fab>
</core-toolbar>

<core-overlay backdrop transition="core-transition-top" id="new_schedule_modal" style="background:#f3f3f3;box-sizing: border-box;-moz-box-sizing: border-box;webkit-user-select: none;-moz-user-select: none;padding:20px 20px;outline: 1px solid rgba(0,0,0,0.2);box-shadow: 0 4px 16px rgba(0,0,0,0.2);">
    <p>To Upload an Updated Transcript:</p>
    <ul>
        <li>Log in to VIP and go DegreeWorks</li>
        <li>Click the "Class History" link</li>
        <li>In the the new window that just opened press "ctrl + p"</li>
        <li>Save this page as a PDF</li>
        <li>When uploading select this PDF</li>
    </ul>
    <div layout center-justified horizontal>
        <paper-button>Upload PDF</paper-button>
    </div>
    <p style="font-weight: bold;" center-justified layout horizontal> - OR -</p>
    <div  layout horizontal center-justified>
        <paper-button id="material_contine_wout">
        <%= link_to "Continute without uploading", new_user_schedule_path(@user), style: "padding: 0;text-decoration: none;color: rgba(0, 0, 0, 0.87);", id: "new_schedule_link" %></paper-button>
    </div>
</core-overlay>

<div style="margin:15px;">
<div layout horizontal center-justified>
    <table style="border: 1px solid black;border-collapse: collapse;" id="schedule_calendar">
        <tr><th></th><th class="day">Monday</th><th class="day">Tuesday</th><th class="day">Wednesday</th><th class="day">Thursday</th><th class="day">Friday</th></tr>
        <% begin_time = Time.new(2000, 1, 1, 8) %>
        <% end_time = Time.new(2000, 1, 1, 21) %>
        <% while begin_time<=end_time %>
            <tr><td class="time_slot"><%= begin_time.strftime("%l:%M%p") %></td><td id="M<%= begin_time.strftime("%l%M%p").strip %>" class="day_time_slot"></td><td class="day_time_slot" id="T<%= begin_time.strftime("%l%M%p").strip %>"></td><td class="day_time_slot" id="W<%= begin_time.strftime("%l%M%p").strip %>"></td><td class="day_time_slot" id="R<%= begin_time.strftime("%l%M%p").strip %>"></td><td class="day_time_slot" id="F<%= begin_time.strftime("%l%M%p").strip %>"></td></tr>
            <% begin_time += 1800 %>
        <% end %>
    
    </table>
</div>

<div layout horizontal center-justified style="margin-top:15px;">
    
    <table>
        <tr><th colspan="3"><%= @user.email %>'s Courses</th></tr>
        <% total_credits = 0 %>
        <% @offerings.each do |offering| %>
            <tr>
              <td><%= offering.course.subject + offering.course.course.to_s + ": " +  offering.course.title %></td>
              <td style="padding-left:20px;padding-right:20px;"><%= offering.course.credits %></td>
              <td><%= offering.user.email[0..-10].capitalize %></td>
            </tr>
            <% total_credits += offering.course.credits %>
        <% end %>
        <tr><td></td><td style="padding-left:20px;padding-right:20px;border-top: solid thin;"><%= total_credits%></td><td></td></tr>
    </table>
</div>
</div>

<script>
    document.getElementById("fab_new_schedule").addEventListener("click", function() {
        document.getElementById("new_schedule_modal").toggle();
    });
</script>


<!--JavaScript to make the weekly schedule-->
<script>
    <% @offerings.each do |offering| %>
        <% offering.days_time.days.split("").each do |letter| %>
            <% begin_time = Time.strptime(offering.days_time.start_time, "%l:%M %P") %>
            <% end_time = Time.strptime(offering.days_time.end_time, "%l:%M %P") %>
            <% index = 0 %>
            
            <% if (end_time - 15.minutes).min == 0 or (end_time - 15.minutes).min == 30 %>
                <% end_time -= 15.minutes %>
                <% flag = true %>
            <% end %>
            
            <% while begin_time<end_time %>
                <% if index == 0 %>
                    document.getElementById("<%= letter %><%= begin_time.strftime("%l%M%p").strip %>").innerHTML = "<%= offering.course.subject + offering.course.course.to_s %>";
                <% elsif index == 1 %>
                    document.getElementById("<%= letter %><%= begin_time.strftime("%l%M%p").strip %>").innerHTML = "<%= offering.user.email[0..-10].capitalize %>";
                <% end %>
                document.getElementById("<%= letter %><%= begin_time.strftime("%l%M%p").strip %>").className = document.getElementById("<%= letter %><%= begin_time.strftime("%l%M%p").strip %>").className + " selected_class";
                <% begin_time += 1800 %>
                <% index += 1 %>
            <% end %>
            <% if flag %>
               document.getElementById("<%= letter %><%= begin_time.strftime("%l%M%p").strip %>").className = document.getElementById("<%= letter %><%= begin_time.strftime("%l%M%p").strip %>").className + " half_time_slot";
            <% end %>
        <% end %>
    <% end %>
</script>
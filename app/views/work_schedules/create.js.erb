var work_dates_array=[];
var work_opts = [];
var nsel_opts = [];
var nsel_dates_array = [];
var disable = [];
var actv_opts = [];

$('#schedule_new_actual_select option:not(:selected)').each(function() {
  nsel_opts.push($(this).attr('value'));
});

work_opts = [<%= @work_schedules.pluck(:id).map(&:to_s).join(", ") %>];

$.each(nsel_opts, function(index, value) {
  var d, t;
  t = $('#' + value).parent().parent();

  d = [t.find('.new_schedule_days_td').text(), t.find('.new_schedule_times_td').text().split(' - ')[0], t.find('.new_schedule_times_td').text().split(' - ')[1]];
  d[1] = Date.parse(d[1]);
  d[2] = Date.parse(d[2]);
  nsel_dates_array.push(d);
});

<% @work_schedules.each do |work| %>
    var d;
    d = ["<%= work.work_days_time.days%>", Date.parse("<%= work.work_days_time.start_time.strftime("%l:%M %p") %>"), Date.parse("<%= work.work_days_time.end_time.strftime("%l:%M %p") %>")]
    work_dates_array.push(d);
<% end %>

$.each(nsel_opts, function(index1, value1) {
  $.each(work_opts, function(index2, value2) {
    if (!(nsel_dates_array[index1][0].indexOf(work_dates_array[index2][0]) === -1)) {
      if (work_dates_array[index2][1] < nsel_dates_array[index1][2] && nsel_dates_array[index1][1] < work_dates_array[index2][2]) {
        disable.push(value1);
      }
    }
  });
});

disable = jQuery.unique(disable);

actv_opts = $(nsel_opts).not(disable).get();

$.each(disable, function(index, value) {
  $('.' + value).parent().parent().attr("hidden", "");
});

$.each(actv_opts, function(index, value) {
  $('.' + value).parent().parent().removeAttr("hidden", "");
});

$(".big_new_schedule_table").each(function(index, node ) {
    var all_hidden = true;
    $(node).find("paper-checkbox").each(function(index2, node2) {
        if($(node2).parent().parent().attr('hidden') != "hidden") {
            all_hidden = false;
            if ($("#media_query_schedule_new")[0].queryMatches) {
                $(node2).parent().parent().next().removeAttr("hidden", "");
            }
        } else {
            if ($("#media_query_schedule_new")[0].queryMatches) {
                $(node2).parent().parent().next().attr("hidden", "");
            }
        }
    });
    if (all_hidden) {
        $(node).find(".no_courses_offered_msg").removeAttr("hidden", "");
        
        if ($(node).find("core-icon").length == 0) {
            $(node).find(".new_schedule_headers").attr("hidden", "");
            if ($("#media_query_schedule_new")[0].queryMatches) {
                $(node).find(".remaining_credits_tr").css("border-bottom", "none");
            }
        } else {
            $(node).find(".new_schedule_headers").removeAttr("hidden", "");
            $(node).find(".prof_th").attr("hidden", "");
            $(node).find(".days_th").attr("hidden", "");
            $(node).find(".time_th").attr("hidden", "");
            $(node).find(".common_tr").attr("hidden", "");
            if ($("#media_query_schedule_new")[0].queryMatches) {
                $(node).find(".remaining_credits_tr").css("border-bottom", "none");
            }
        }
    } else {
        if (!$("#media_query_schedule_new")[0].queryMatches) {
            $(node).find(".no_courses_offered_msg").attr("hidden", "");
            $(node).find(".new_schedule_headers").removeAttr("hidden", "");
            $(node).find(".prof_th").removeAttr("hidden", "");
            $(node).find(".days_th").removeAttr("hidden", "");
            $(node).find(".time_th").removeAttr("hidden", "");   
            $(node).find(".common_tr").removeAttr("hidden", "");
        } else {
            $(node).find(".no_courses_offered_msg").attr("hidden", "");
            $(node).find(".new_schedule_headers").attr("hidden", "");
            $(node).find(".prof_th").attr("hidden", "");
            $(node).find(".days_th").attr("hidden", "");
            $(node).find(".time_th").attr("hidden", "");   
            $(node).find(".common_tr").attr("hidden", "");        
            $(node).find(".remaining_credits_tr").css("border-bottom", "1px solid rgba(0, 0, 0, 0.12)");
        }
    }
});



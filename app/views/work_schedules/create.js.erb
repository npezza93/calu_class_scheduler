var work_dates_array=[];
var work_opts = [];
var nsel_opts = [];
var nsel_dates_array = [];
var disable = [];

$("#remove-work-schedule-div").append("<%= j link_to @work_schedule.pretty_day_time, user_work_schedule_path(@user, @work_schedule), method: :delete, data: {}, remote: true, class: 'work_schedule_' + @work_schedule.work_days_time.id.to_s + ' delete-work-schedule-link' %>")

$('#schedule_new_actual_select option:not(:selected)').each(function() {
  nsel_opts.push($(this).attr('value'));
});

$.each(nsel_opts, function(index, value) {
  var d, t;
  t = $('#' + value).parent().parent();

  d = [t.attr("days"), Date.parse(t.attr("start-time")), Date.parse(t.attr("end-time"))];
  d[1] = Date.parse(d[1]);
  d[2] = Date.parse(d[2]);
  nsel_dates_array.push(d);
});

work_date = ["<%= @work_schedule.work_days_time.days%>", Date.parse("<%= @work_schedule.work_days_time.start_time.strftime("%l:%M %p") %>"), Date.parse("<%= @work_schedule.work_days_time.end_time.strftime("%l:%M %p") %>")]

$.each(nsel_opts, function(index1, value1) {
    if (!(nsel_dates_array[index1][0].indexOf(work_date[0]) === -1)) {
      if (work_date[1] < nsel_dates_array[index1][2] && nsel_dates_array[index1][1] < work_date[2]) {
        disable.push(value1);
      }
    }
});

disable = jQuery.unique(disable);

$.each(disable, function(index, value) {
  $('.' + value).parent().parent().attr("hidden", "");
});


$(".category-items.incomplete-category").each(function() {
    var all_hidden = true;
    var categoryNode = $(this);

    categoryNode.find(".offering-div").each(function() {
        var count = $(this).find("paper-icon-item").length;
        var offeringCourseNode = $(this);
        offeringCourseNode.find("paper-icon-item").each(function() {
            if ($(this).attr('hidden')) {
                count--;
            }
        });
        if (count == 0) {
            $(offeringCourseNode.children()[0])[0].classList.add("inactive");
        } else {
            all_hidden = false;
        }
    });
    if (all_hidden) {
        $(categoryNode.children()[1]).removeAttr("hidden");
    }
});

if ($("#media_query_schedule")[0].queryMatches) {
  $("#big_schedule_table")[0].setAttribute("hidden", "");
  $("#small_schedule_table")[0].removeAttribute("hidden", "");
  $(".small_schedule_course_title").removeAttr("hidden", "");
} else {
  $("#big_schedule_table")[0].removeAttribute("hidden", "");
  $("#small_schedule_table")[0].setAttribute("hidden", "");
  $(".small_schedule_course_title").attr("hidden", "");
}
<% content_for :title do %>
    Editing <%= @course.subject + @course.course.to_s %>
<% end %>

<div layout horizontal center-justified>
    <paper-shadow id="new_course_shadow_div">
        <%= form_for(@course, remote: true) do |f| %>
        
            <paper-input-decorator label="Subject (ex: CSC, CET, etc)" class="password_decorator">
                <%= f.text_field :subject, maxlength: 3, size: 3, is: 'core-input' %>
            </paper-input-decorator>
            
            <paper-input-decorator label="Course Number (ex: 120, 323, etc)" class="password_decorator">
                <%= f.text_field :course, maxlength: 3, size: 3, is: 'core-input' %>
            </paper-input-decorator>
            
            <paper-input-decorator label="Title (ex: Operating Systems)" class="password_decorator">
                <%= f.text_field :title, is: 'core-input' %>
            </paper-input-decorator>
            
            <paper-input-decorator label="Credits (ex: Defaults to 3)" class="password_decorator">
                <%= f.text_field :credits, is: 'core-input' %>
            </paper-input-decorator>
            
            <br>
            <%= f.label 'Choose Required Prerequisites (if any):', style: "font-size:15px;font-weight:bold;"%>
            <br>
            <%= f.select(:minimum_pt, options_for_select([["No Placement Test must be passed", ""],["Passing Part A of the Math Placement Exam", "A"],["Passing Part B of the Math Placement Exam", "B"],["Passing Part C of the Math Placement Exam", "C"],["Passing Part D of the Math Placement Exam", "D"]], @course.minimum_pt)) %>
            <br>
            <%= f.select(:minimum_class_standing, options_for_select(["No minimum class standing","Senior", "Junior", "Sophmore", "Freshman"], @course.minimum_class_standing)) %>
            <br>
            <%= f.select(:minimum_sat_score, options_for_select([["No minimum SAT score", ""],["520 on Mathematics or better", "520"], ["580 on Mathematics or better","580"], ["440 on Mathematics or better","440"]], @course.minimum_sat_score)) %>
            <br>
            
            <div id="prereq_groups">
                <% @prereqs.each_with_index do |(group_id, prereqs), index| %>
                    <div class="course_prereq_group <%= group_id %>" layout vertical>
                        <%= f.label 'Group ' + group_id.to_s + ':' %>
                        <%= f.select(:prerequisites, options_for_select(@courses, prereqs.collect(&:prerequisite_course_id)), {}, { class: "actual_select_courses", multiple: true, size: 6}) %>
                        <br>
                    </div>
                    <% if @prereqs.size > (index +1) %>
                        <div layout horizontal center-justified> - OR -</div>
                    <% end %>
                <% end %>
    
                <% if @prereqs.blank? %>
                    <div class="course_prereq_group 1" layout vertical>
                        <%= f.label 'Group 1:' %>
                        <%= f.select(:prerequisites, options_for_select(@courses), {}, { class: "actual_select_courses", multiple: true, size: 6}) %>
                        <br>
                    </div>
                <% end %>
            </div>
            
            
            <div layout center-justified horizontal style="color:#4CAF50;">
                <paper-button onclick="orClause()">ADD an or group</paper-button>
            </div>

            <div style="width:100%;" id="prereq_min_grades">
                <% min_grades_temp = "" %>
                <% @prereqs.each do |group_id, prereqs| %>
                    <% prereqs.each do |prereq| %>
                        <div layout horizontal style="margin-top:5px;margin-bottom:5px;"><div flex><%= prereq.prerequisite_course.title %></div><div><%= select_tag(:minimum_grades, options_for_select(["N/A","C", "C-"], prereq.minimum_grade), class: "prereq_grades_dropdown") %></div></div>
                        <% min_grades_temp += ((prereq.minimum_grade == nil) ? "N/A" :  prereq.minimum_grade)+ "/|/" %>
                    <% end %>
                <% end %>
            </div>
            <%= text_field_tag :prereq_grades, min_grades_temp, hidden: "" %>
            
            <br><br>
            <div layout horizontal end-justified style="color:#2196F3;">
                <paper-button id="cancel_new_course">Cancel</paper-button>
                <paper-button id="material_update_course">Update</paper-button>
            </div>
    
            <%= f.submit 'Update', hidden: "", id: 'actual_update_course' %>
            
            <script>
                var max_group_id = <%= @max_group_id %>;
                function orClause() {
                    max_group_id = max_group_id +1;
                    $(".course_prereq_group").last().after("<div layout horizontal center-justified> - OR -</div><div class=\"course_prereq_group " + max_group_id + "\"><label>Group " + max_group_id + "</label><%= j f.select(:prerequisites, options_for_select(@courses), {}, { class: "actual_select_courses", multiple: true, size: 6}) %></div>");
                }
                
                $("#prereq_groups").on("change",  "select", function() {
                    $("#prereq_min_grades").html("");
                    $(".actual_select_courses option:selected").each(function() {
                        $("#prereq_min_grades").append("<div layout horizontal style='margin-top:5px;margin-bottom:5px;'><div flex>" + $(this).text() + "</div><div><%= j select_tag(:minimum_grades, options_for_select(["N/A","C", "C-"]), class: "prereq_grades_dropdown") %></div></div>");
                    });
                    var string = "";
                    $(".prereq_grades_dropdown option:selected").each(function() {
                        string += $(this).text() + "/|/"
                    });
                    $("#prereq_grades").val(string);
                });
                
                $("#prereq_min_grades").on("change",  "select", function() {
                    var string = "";
                    $(".prereq_grades_dropdown option:selected").each(function() {
                        string += $(this).text() + "/|/"
                    });
                    $("#prereq_grades").val(string);
                });
            </script> 
        <% end %>
    </paper-shadow>
</div>